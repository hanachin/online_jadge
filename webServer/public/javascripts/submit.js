// Generated by CoffeeScript 1.6.2
/* ---- class ---------------------
*/

var HTMLtemplate;

HTMLtemplate = (function() {
  var _accept, _compile, _segmentationFault, _timelimit, _wrongAnswer;

  function HTMLtemplate() {}

  _accept = '<h1 style=\'font-family: times new roman; font-size: 100px; padding: 80px; line-height: 85px;\'>Accept</h1>\n  <p>正解です。</p>\n  <p>おめでとうございます！</p>';

  _timelimit = '<h2 style=\'font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;\'>TimeLimit Exceeded</h2>\n<p>不正解です。プログラムの実行に時間がかかっています。</p>\n<p>ループのチェックをしてみましょう！</p>';

  _compile = '<h2 style=\'font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;\'>Compile Error</h2>\n<p>不正解です。コンパイルができません。</p>\n<p>C言語の文法をチェックしてみましょう！</p>';

  _segmentationFault = '<h2 style=\'font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;\'>#{result}</h2>\n<p>不正解です。プログラムがメモリ空間に異常を与えています。</p>\n<p>ループの異常、またはポインタやscanfの文法をチェックしてみましょう！</p>';

  _wrongAnswer = '<h2 style=\'font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;\'>Wrong Answer</h2>\n<p>不正解です。実行にエラーはないので、出力と出力例を見比べてみましょう！</p>';

  HTMLtemplate.getAC = function() {
    return _accept;
  };

  HTMLtemplate.getTimelimit = function() {
    return _timelimit;
  };

  HTMLtemplate.getCompileError = function() {
    return _compile;
  };

  HTMLtemplate.getSegmentationFault = function() {
    return _segmentationFault;
  };

  HTMLtemplate.getWrongAnswer = function() {
    return _getWrongAnswer;
  };

  return HTMLtemplate;

})();

/* ---- main ---------------------
*/


$(function() {
  var debugMode, displayErrorMsg, displayLoading, displayResultMsg, loadErea, requestJudgeServer, resultErea, socket, sourceErea, submitMode, switchAfterJudge, switchDebugWindow, switchModalWindow;

  sourceErea = $('#textarea');
  resultErea = $('#resultarea');
  loadErea = $('#loadingerea');
  submitMode = $('#submit_mode');
  debugMode = $('#debag_mode');
  socket = io.connect('http://localhost:8080');
  $('#displaymodal').click(function() {
    return switchModalWindow();
  });
  $('#debag').click(function() {
    return switchDebugWindow();
  });
  $('#submit').click(function() {
    var questionNo, source;

    questionNo = $("#questionNo").text();
    source = editAreaLoader.getValue("code_area");
    displayLoading();
    submitMode.css('display', 'none');
    return requestJudgeServer(resultErea, questionNo, source);
  });
  /* ---- function ---------------
  */

  switchModalWindow = function() {
    sourceErea.css('display', 'block');
    loadErea.css('display', 'none');
    resultErea.css('display', 'none');
    debugMode.css('display', 'none');
    return submitMode.css('display', 'block');
  };
  switchDebugWindow = function() {
    sourceErea.css('display', 'block');
    loadErea.css('display', 'none');
    resultErea.css('display', 'none');
    debugMode.css('display', 'none');
    return submitMode.css('display', 'block');
  };
  displayLoading = function() {
    $('#loadingerea').append(loadIcon.canvas);
    sourceErea.css('display', 'none');
    return loadErea.css('display', 'block');
  };
  requestJudgeServer = function(resultErea, questionNo, source) {
    socket.emit('submit_source', {
      questionNo: questionNo,
      source: source
    });
    return socket.on('result_judge', function(json) {
      var error, msg, res, result;

      res = $.parseJSON(json);
      result = displayResultMsg(res.result);
      error = displayErrorMsg(res.cmperr, res.stderr);
      msg = result + error;
      resultErea.html(msg);
      return switchAfterJudge();
    });
  };
  displayResultMsg = function(result) {
    var msg;

    msg = '';
    switch (result) {
      case 'Accept':
        msg = HTMLtemplate.getAccept();
        break;
      case 'Time Limit Exceeded':
        msg = HTMLtemplate.getTimelimit();
        break;
      case 'Compile Error':
        msg = HTMLtemplate.getCompileError();
        break;
      case 'Segmentation Fault':
        msg = HTMLtemplate.getSegmentationFault();
        break;
      default:
        msg = HTMLtemplate.getWrongAnswer();
    }
    return msg;
  };
  displayErrorMsg = function(cmperr, stderr) {
    var error;

    error = '';
    if (cmperr !== '') {
      error = "<pre style='overflow:auto; max-height:135px; text-align: left; width: 80%; margin: 40px auto; line-height: 27px;'>" + cmperr + "</pre>";
    }
    if (stderr !== '') {
      error = "<pre style='overflow:auto; max-height:135px; text-align: left; width: 80%; margin: 40px auto; line-height: 27px;'>" + stderr + "</pre>";
    }
    return error;
  };
  return switchAfterJudge = function() {
    sourceErea.css('display', 'none');
    loadErea.css('display', 'none');
    debugMode.css('display', 'block');
    return resultErea.css('display', 'block');
  };
});
