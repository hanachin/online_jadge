// Generated by CoffeeScript 1.4.0

$(function() {
  var debag_mode, loadingErea, resultErea, sourcecodeErea, submit_mode;
  sourcecodeErea = $('#textarea');
  resultErea = $('#resultarea');
  loadingErea = $('#loadingerea');
  submit_mode = $('#submit_mode');
  debag_mode = $('#debag_mode');
  $('#loadingerea').append(loadImg.canvas);
  $('#displaymodal').click(function() {
    sourcecodeErea.css('display', 'block');
    loadingErea.css('display', 'none');
    resultErea.css('display', 'none');
    debag_mode.css('display', 'none');
    return submit_mode.css('display', 'block');
  });
  $('#debag').click(function() {
    sourcecodeErea.css('display', 'block');
    loadingErea.css('display', 'none');
    resultErea.css('display', 'none');
    debag_mode.css('display', 'none');
    return submit_mode.css('display', 'block');
  });
  return $('#submit').click(function() {
    var questionNo, source;
    questionNo = $("#questionNo").text();
    source = editAreaLoader.getValue("code_area");
    sourcecodeErea.css('display', 'none');
    loadingErea.css('display', 'block');
    submit_mode.css('display', 'none');
    return $.ajax({
      url: '/submit_source',
      type: 'post',
      data: {
        questionNo: questionNo,
        source: source
      },
      cache: true
    }).done(function(data) {
      var cmperr, displayresult, resJSON, result, stderr;
      resJSON = $.parseJSON(data);
      console.log(resJSON);
      result = resJSON.result;
      cmperr = resJSON.cmperr;
      stderr = resJSON.stderr;
      sourcecodeErea.css('display', 'none');
      loadingErea.css('display', 'none');
      debag_mode.css('display', 'block');
      resultErea.css('display', 'block');
      switch (result) {
        case 'Accept':
          displayresult = "<h1 style='font-family: times new roman; font-size: 100px; padding: 80px; line-height: 85px;'>" + result + "</h1>\n<p>正解です。</p>\n<p>おめでとうございます！</p>";
          break;
        case "Time Limit Exceeded":
          displayresult = "<h2 style='font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;'>" + result + "</h2>\n<p>不正解です。プログラムの実行に時間がかかっています。</p>\n<p>ループのチェックをしてみましょう！</p>";
          break;
        case "Compile Error":
          displayresult = "<h2 style='font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;'>" + result + "</h2>\n<p>不正解です。コンパイルができません。</p>\n<p>C言語の文法をチェックしてみましょう！</p>";
          break;
        case "Segmentation Fault":
          displayresult = "<h2 style='font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;'>" + result + "</h2>\n<p>不正解です。プログラムがメモリ空間に異常を与えています。</p>\n<p>ループの異常、またはポインタやscanfの文法をチェックしてみましょう！</p>";
          break;
        default:
          displayresult = "<h2 style='font-family: times new roman; font-size: 80px; padding: 40px; line-height: 85px;'>" + result + "</h2>\n<p>不正解です。出力と出力例を見比べてみましょう！</p>";
      }
      if (cmperr !== '') {
        displayresult += "<pre style='overflow:auto; max-height:135px; text-align: left; width: 80%; margin: 40px auto; line-height: 27px;'>" + cmperr + "</pre>";
      }
      if (stderr !== '') {
        displayresult += "<pre style='overflow:auto; max-height:135px; text-align: left; width: 80%; margin: 40px auto; line-height: 27px;'>" + stderr + "</pre>";
      }
      return resultErea.html(displayresult);
    }).fail(function() {
      return alert('サーバ通信エラー');
    });
  });
});
